<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Commands | Fabula</title>
    <meta name="description" content="Minimalist server configuration and task management.">
    
    
    <link rel="preload" href="/fabula/assets/css/0.styles.22f05657.css" as="style"><link rel="preload" href="/fabula/assets/js/app.a7fb14c3.js" as="script"><link rel="preload" href="/fabula/assets/js/5.fb08720f.js" as="script"><link rel="prefetch" href="/fabula/assets/js/2.faeb1fcf.js"><link rel="prefetch" href="/fabula/assets/js/3.9c2e3e97.js"><link rel="prefetch" href="/fabula/assets/js/4.cb120cc3.js"><link rel="prefetch" href="/fabula/assets/js/6.65d91907.js"><link rel="prefetch" href="/fabula/assets/js/7.2876f6ef.js"><link rel="prefetch" href="/fabula/assets/js/8.883af14f.js">
    <link rel="stylesheet" href="/fabula/assets/css/0.styles.22f05657.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fabula/" class="home-link router-link-active"><!----> <span class="site-name">Fabula</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/nuxt/fabula" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"> <a href="https://github.com/nuxt/fabula" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Guide</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/fabula/" class="sidebar-link">Introduction</a></li><li><a href="/fabula/installation.html" class="sidebar-link">Installation</a></li><li><a href="/fabula/components.html" class="sidebar-link">Components</a></li><li><a href="/fabula/commands.html" class="active sidebar-link">Commands</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fabula/commands.html#local" class="sidebar-link">Local</a></li><li class="sidebar-sub-header"><a href="/fabula/commands.html#append" class="sidebar-link">Append</a></li><li class="sidebar-sub-header"><a href="/fabula/commands.html#write" class="sidebar-link">Write</a></li><li class="sidebar-sub-header"><a href="/fabula/commands.html#put" class="sidebar-link">Put</a></li><li class="sidebar-sub-header"><a href="/fabula/commands.html#custom" class="sidebar-link">Custom</a></li><li class="sidebar-sub-header"><a href="/fabula/commands.html#registration" class="sidebar-link">Registration</a></li></ul></li><li><a href="/fabula/authentication.html" class="sidebar-link">Authentication</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="commands"><a href="#commands" aria-hidden="true" class="header-anchor">#</a> Commands</h1> <p>As stated in the introduction, <strong>every command available to the underlying Bash
shell</strong> will work in a <strong>Fabula</strong> task. There are however a few convenience
commands that are specific to <strong>Fabula</strong>.</p> <h2 id="local"><a href="#local" aria-hidden="true" class="header-anchor">#</a> Local</h2> <p>Every command preceded by <code>local</code> will run on the local machine:</p> <div class="language-sh extra-class"><pre class="language-text"><code>local mkdir -p /tmp/foobar
local touch /tmp/foobar
</code></pre></div><h2 id="append"><a href="#append" aria-hidden="true" class="header-anchor">#</a> Append</h2> <p>Appends a block text or string to the file in the specified path.</p> <blockquote><p>Availability: <code>local</code> and <code>remote</code></p></blockquote> <h3 id="simple-use"><a href="#simple-use" aria-hidden="true" class="header-anchor">#</a> Simple use</h3> <div class="language-sh extra-class"><pre class="language-text"><code>local append /path/to/file:
  multi-line contents
  to be appended to the file 
</code></pre></div><p>Text will be automatically dedented to the number of total white
spaces in the <strong>first line</strong>.</p> <h3 id="with-string-id"><a href="#with-string-id" aria-hidden="true" class="header-anchor">#</a> With string id</h3> <div class="language-sh extra-class"><pre class="language-text"><code>&lt;fabula&gt;
export default {
  path: '/path/to/file '
}
&lt;/fabula&gt;

&lt;commands&gt;
local append &lt;%= path %&gt; strings.contents
&lt;/commands&gt;

&lt;string id=&quot;contents&quot;&gt;
multi-line contents
to be appended to the file 
&lt;/string&gt;
</code></pre></div><h2 id="write"><a href="#write" aria-hidden="true" class="header-anchor">#</a> Write</h2> <p>Writes a block text or string to the file in the specified path.</p> <blockquote><p>Availability: <code>local</code> and <code>remote</code></p></blockquote> <p>This command has essentially the same semantics of <code>append</code>, with the difference
that it will never append to, but rather overwrite the contents of the target entirely.</p> <div class="language-sh extra-class"><pre class="language-text"><code>local write /path/to/file:
  multi-line contents
  to be written to the file
</code></pre></div><h2 id="put"><a href="#put" aria-hidden="true" class="header-anchor">#</a> Put</h2> <p>Copies file in path from the local machine to path on the remote server.</p> <blockquote><p>Availability: <code>remote</code></p></blockquote> <div class="language-sh extra-class"><pre class="language-text"><code>put /path/to/local/file /path/on/remote/server
</code></pre></div><h2 id="custom"><a href="#custom" aria-hidden="true" class="header-anchor">#</a> Custom</h2> <p>To make the bash script parser as flexible and fault-tolerant as possible,
<code>fabula</code> introduces a simple, straight-forward compiler with an API for writing
command handlers. The special <code>put</code> built-in command for instance, is
defined under <code>src/commands/put.js</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> put <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../ssh'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">match</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> line<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/^put\s+(.+)\s+(.+)/</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">line</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">.</span>sourcePath <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>match<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">.</span>targetPath <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>match<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">command</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">put</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">.</span>sourcePath<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>param<span class="token punctuation">.</span>targetPath<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p><code>match()</code> is called once for every new line, if no previous command is still
being parsed. If <code>match()</code> returns <code>true</code>, <code>line()</code> will run for the current
and every subsequent line as long as you keep returning <code>true</code>, which means,
<em>continue parsing lines for the <strong>current command</strong></em>.</p></li> <li><p>When <code>line()</code> returns  <code>false</code> or <code>undefined</code>, the compiler understands the
current command is <strong>done parsing</strong> and moves on.</p></li> <li><p>with <code>line()</code>, we can store data that is retrieved from each line in the
command block, make it availble under <code>this.params</code> and later access it when
actually calling <code>command()</code> (done automatically when running scripts).</p></li></ul> <h2 id="registration"><a href="#registration" aria-hidden="true" class="header-anchor">#</a> Registration</h2> <p>Say you want to register the command <code>special &lt;arg&gt;</code>, that can run only on the
local machine. You can programmatically add a custom command handler to your
<code>fabula.js</code> configuration file, under <code>commands</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  commands<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token function">match</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>local <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">const</span> match <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/^special\s+(.+)/</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">.</span>arg <span class="token operator">=</span> match<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> match
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">command</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span> stdout<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`From special command: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">.</span>arg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!`</span></span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Note that you could also use an external module:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> specialCommand <span class="token keyword">from</span> <span class="token string">'./customCommand'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  commands<span class="token punctuation">:</span> <span class="token punctuation">[</span> specialCommand <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>If you have a <code>task.fab</code> file with <code>special foobar</code>, its output will be:</p> <div class="language-sh extra-class"><pre class="language-text"><code>ℹ [local] From special command: foobar!
ℹ [local] [OK] special foobar
</code></pre></div><p>Note that you have successfuly defined a local command that can be ran without
being preceded by <code>local</code>. That is because you <strong>manually</strong> set it to <code>local</code>
in <code>match()</code>. You can use <code>match()</code> to determine if the command is local or not
and still make it work both ways. <strong>Fabula</strong>'s built-in <code>write</code> and <code>append</code> are
good examples of this and the subject of the next topic.</p> <h3 id="advanced-example"><a href="#advanced-example" aria-hidden="true" class="header-anchor">#</a> Advanced example</h3> <div class="language-sh extra-class"><pre class="language-text"><code>local write /path/to/file:
  contents
local write /path/to/file string.id
write /path/to/file:
  contents
write /path/to/file string.id
local append /path/to/file:
  contents
local append /path/to/file string.id
append /path/to/file string.id
</code></pre></div><p>The snippet above contains commands that are handled by the same internal Fabula
code. Let's take a quick dive into how it works.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> write<span class="token punctuation">,</span> append <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../ssh'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> localWrite<span class="token punctuation">,</span> localAppend <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../local'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'write'</span><span class="token punctuation">,</span>
  patterns<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    block<span class="token punctuation">:</span> <span class="token punctuation">(</span>argv<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`^(?:local\\s*)?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\\s+(.+?):$`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    string<span class="token punctuation">:</span> <span class="token punctuation">(</span>argv<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`^(?:local\\s*)?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\\s+([^ ]+?)\\s+([^ :]+?)$`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">match</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> argv <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>argv<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'local'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      argv<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>local <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>op <span class="token operator">=</span> argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dedent <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'append'</span><span class="token punctuation">,</span> <span class="token string">'write'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> match
      <span class="token comment">// eslint-disable-next-line no-cond-assign</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>match <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cmd<span class="token punctuation">.</span>patterns<span class="token punctuation">.</span><span class="token function">block</span><span class="token punctuation">(</span>argv<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>block <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">return</span> match
      <span class="token comment">// eslint-disable-next-line no-cond-assign</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>match <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cmd<span class="token punctuation">.</span>patterns<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>argv<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>string <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">return</span> match
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>First we importing all necessary dependencies and define <code>match()</code>, which uses
two kinds of patterns for matching the command: one is for dedented blocks of
text (<code>patterns.block</code>) and other for string references (<code>patterns.string</code>).
<code>match()</code> also takes care of setting the <code>local</code> attribute for the command.</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function">line</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>firstLine<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">.</span>filePath <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>match<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>block<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">.</span>fileLines <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>string<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> settingsKey <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>match<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
        <span class="token comment">// eslint-disable-next-line no-eval</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">.</span>fileBody <span class="token operator">=</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`this.settings.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>settingsKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token regex">/^\s+/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">.</span>fileLines<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> match <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/^\s+/</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>match<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>dedent <span class="token operator">=</span> match<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">.</span>fileLines<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dedent<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>The magic happens in <code>line()</code>, which will continue parsing the command in
subsequent lines if it's a block of text, or use the provided string reference.
For convenience, we store the provided text in either <code>fileLines</code> or <code>fileBody</code>,
which are then retrieved by <code>command()</code>.</p> <p>command(conn) {
const filePath = this.params.filePath
const fileContents = this.string
? this.params.fileBody.split('\n')
: this.params.fileLines</p> <pre><code>if (this.local) {
  const cmd = ({ write: localWrite, append: localAppend })[this.op]
  return cmd({ filePath, fileContents })
} else {
  return ({ write, append })[this.op](conn, { filePath, fileContents })
}
</code></pre> <p>}
}</p> <div class="language- extra-class"><pre class="language-text"><code>
As **Fabula** evolves, the code for this command and underlying functions it 
calls will likely change, but the API for defining and parsing the commands is
likely to stay the same as dissecated in this article.
</code></pre></div></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/nuxt/fabula/edit/master/docs/commands.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/fabula/components.html" class="prev">
          Components
        </a></span> <span class="next"><a href="/fabula/authentication.html">
          Authentication
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/fabula/assets/js/app.a7fb14c3.js" defer></script><script src="/fabula/assets/js/5.fb08720f.js" defer></script>
  </body>
</html>
