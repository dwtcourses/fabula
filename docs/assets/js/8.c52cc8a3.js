(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{174:function(t,a,s){"use strict";s.r(a);var e=s(0),n=Object(e.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._m(7),t._v(" "),t._m(8),t._v(" "),t._m(9),t._m(10),t._v(" "),t._m(11),t._v(" "),s("p",[t._v("Take "),s("a",{attrs:{href:"https://github.com/nuxt/fabula/blob/master/test/fixtures/handler.fab",target:"_blank",rel:"noopener noreferrer"}},[t._v("this example"),s("OutboundLink")],1),t._v(" from the test suite fixtures.")]),t._v(" "),t._m(12),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),s("p",[t._v("Or, alternatively, grouped in a block:")]),t._v(" "),t._m(17),s("p",[t._v("Note that if you use "),s("code",[t._v("<commands>")]),t._v(" with a "),s("router-link",{attrs:{to:"./components.html#prepend"}},[t._v("prepend command")]),t._v(" all commands\nwithin "),s("code",[t._v("ensure")]),t._v(" will be altered, but not "),s("code",[t._v("ensure")]),t._v(" itself.")],1),t._v(" "),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20)])},[function(){var t=this.$createElement,a=this._self._c||t;return a("h1",{attrs:{id:"failure"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#failure","aria-hidden":"true"}},[this._v("#")]),this._v(" Failure")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("By default, a single failing command will cause "),a("strong",[this._v("Fabula")]),this._v(" to exit and prevent\nany subsequent commands or tasks from running. You can disable this behaviour in "),a("strong",[this._v("Fabula")]),this._v("'s configuration file:")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  fail"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("You can also set "),a("code",[this._v("fail: false")]),this._v(" on a "),a("strong",[this._v("Fabula")]),this._v(" component.")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"handlers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#handlers","aria-hidden":"true"}},[this._v("#")]),this._v(" Handlers")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("You can handle results for individual commands as well. A common example is\nhandling a "),a("code",[this._v("yarn install")]),this._v(" result. If "),a("code",[this._v("fail")]),this._v(" is set to "),a("code",[this._v("false")]),this._v(", you may want\nto handle the result of certain commands.")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("fabula")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\nexport default {\n  fail: false\n}\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("fabula")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("commands")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\nunimportant command 1\nunimportant command 2\nyarn install\nyarn build\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("commands")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("In the above script, you would want to ensure "),a("code",[this._v("yarn install")]),this._v(" finished\nsuccesfully before moving on to "),a("code",[this._v("yarn build")]),this._v(", even though you don't care about\nthe first two unimportant commands.")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[a("strong",[this._v("Fabula")]),this._v(" lets you tag an individual command line and set a "),a("em",[this._v("callback")]),this._v(" matching\nthe tag given:")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("fabula")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\nexport default {\n  fail: false,\n  check({ code, stderr }, fabula) {\n    if (code) {\n      fabula.abort()\n    }\n  }\n}\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("fabula")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("commands")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\nunimportant command 1\nunimportant command 2\nyarn install @check\nyarn build\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("commands")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("p",[t._v("You can tag a command by placing a label prefixed with "),s("strong",[s("code",[t._v("@")])]),t._v(" at the end of it.\nYou can then set a handler method named with the same label. The first parameter\npassed to the handler method is the result object, which contains "),s("code",[t._v("code")]),t._v(" (exit\ncode), "),s("code",[t._v("stdout")]),t._v(", "),s("code",[t._v("stdin")]),t._v(" and also "),s("code",[t._v("cmd")]),t._v(" -- a reference to the Fabula object\nrepresenting the parsed command. The second parameter is the "),s("strong",[t._v("Fabula")]),t._v(" context,\nwhich provides access to "),s("code",[t._v("settings")]),t._v(" and "),s("code",[t._v("abort()")]),t._v(".")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("You can also provide a block of commands to run after the handler. This allows\nyou to add or change properties in "),a("strong",[this._v("Fabula")]),this._v("'s settings object prior to the\nJavaScript preprocessing.")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("fabula")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\nexport default {\n  fail: false,\n  handle: (result) => {\n    return {\n      touchErrorCode: result.code\n    }\n  }\n}\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("fabula")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("commands")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("local")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\ntouch /parent/doesnt/exist @handle:\n  local write /tmp/fabula-handler-test:\n    <%= touchErrorCode %>\ncat /tmp/fabula-handler-test\nrm /tmp/fabula-handler-test\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("commands")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("p",[t._v("The block after "),s("code",[t._v("@handle")]),t._v(" is only compiled after the current command has been\nexecuted and you've had a chance to "),s("strong",[t._v("handle")]),t._v(" it. The handling function (which\nmust match the "),s("code",[t._v("@name")]),t._v(" you use to tag the command) can return an object which\nis then merged back into "),s("strong",[t._v("Fabula")]),t._v(" settings object. The snippet above will\nresult in "),s("code",[t._v("1")]),t._v(" being written to the test file (which is then removed so no\ntesting files are left behind).")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"ensure"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ensure","aria-hidden":"true"}},[this._v("#")]),this._v(" Ensure")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("For the sole purpose of ensuring that a specific command runs successfully in\na "),a("strong",[this._v("Fabula")]),this._v(" task otherwise permissive to failure, you can also use the special\n"),a("code",[this._v("ensure")]),this._v(" command:")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("commands")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\nunimportant command 1\nunimportant command 2\nensure yarn install\nyarn build\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("commands")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("commands")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\nunimportant command 1\nunimportant command 2\nensure:\n  yarn install\n  yarn build\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("commands")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"retries"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#retries","aria-hidden":"true"}},[this._v("#")]),this._v(" Retries")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("Fabula has a built-in retry mechanism. Use the "),a("code",[this._v("-r")]),this._v(" flag to specify the numbers\nof attempts that must be made for every command before accepting failure.")])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[this._v("$ fabula all tasks/common-task -r 3\n")])])])}],!1,null,null,null);a.default=n.exports}}]);